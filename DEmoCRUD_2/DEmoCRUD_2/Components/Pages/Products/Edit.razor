@page "/products/edit/{Id:int}"
@rendermode InteractiveServer
@using DEmoCRUD_2.Models
@using DEmoCRUD_2.Services
@inject IProductService ProductService
@inject ICategoryService CategoryService
<h3>Edit</h3>

<EditForm Model="product" FormName="editProduct" OnValidSubmit="SaveProduct">
    <DataAnnotationsValidator />
    <div class="form-group">
        <label>Name</label>
        <InputText @bind-Value="product.Name"/>
    </div>
    <div class="form-group">
        <label>Price</label>
        <InputNumber @bind-Value="product.Price"/>
    </div>
    <div class="form-group">
        <label>Quantity</label>
        <InputNumber @bind-Value="product.Quantity"/>
    </div>
    <div class="form-group">
        <label>Category</label>
        <InputSelect @bind-Value="product.CategoryId">
            @foreach (var category in categories)
            {
                <option value="@category.Id">
                    @category.Name
                </option>
            }
        </InputSelect>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-primary">
            Save
        </button>
    </div>

</EditForm>

@code {
    Product product = new Product();
    List<Category> categories = new List<Category>();
    [Inject] public NavigationManager Navigation { get; set; }
    [Parameter] public int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        categories = await CategoryService.GetAllCategoryAsync();
        product = await ProductService.GetProductByIdAsync(Id);
    }

    public async Task SaveProduct()
    {
        await ProductService.UpdateProductAsync(product);
        Navigation.NavigateTo("/products", true);
    }
}